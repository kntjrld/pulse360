/* ---------------------------------------------------------
   VARIABLES (LIGHT + DARK) + FIXED DIMENSIONS
--------------------------------------------------------- */
:root {
  --c-bg: #f5f6fa;
  --c-card: #ffffff;
  --c-sidebar: #1f1f1f;
  --c-sidebar-light: #2a2a2a;
  --c-text: #e5e7eb;
  --c-text-dark: #1f2937;
  --c-accent: #3b82f6;
  --c-accent-soft: rgba(59, 130, 246, 0.2);
  --shadow: 0 2px 8px rgba(0,0,0,0.15);
  --transition: 0.28s cubic-bezier(0.4, 0.0, 0.2, 1);

  /* Sidebar fixed rules */
  --sidebar-expanded: 260px;
  --sidebar-collapsed: 80px;
  --nav-item: 48px;      /* square clickable size when collapsed */
  --icon-size: 22px;
}

:root.dark {
  --c-bg: #111827;
  --c-card: #1f2937;
  --c-sidebar: #0d0f14;
  --c-sidebar-light: #1a1c23;
  --c-text: #e5e7eb;
  --c-text-dark: #f9fafb;
  --c-accent-soft: rgba(59, 130, 246, 0.25);
}

/* ---------------------------------------------------------
   GLOBAL
--------------------------------------------------------- */
*,
*::before,
*::after {
  box-sizing: border-box; /* prevents width+padding overflow/offsets */
}

html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  font-family: "Segoe UI", sans-serif;
  background: var(--c-bg);
  overflow: hidden;
}

.hidden { display: none !important; }

/* ---------------------------------------------------------
   SIDEBAR
--------------------------------------------------------- */
#sidebar {
  position: fixed;
  top: 0;
  left: 0;
  width: var(--sidebar-expanded);
  height: 100%;
  background: var(--c-sidebar);
  color: var(--c-text);
  display: flex;
  flex-direction: column;
  padding: 8px 0;
  box-shadow: var(--shadow);
  transition: width var(--transition);
  z-index: 1100;
}

#sidebar.expanded { width: var(--sidebar-expanded); }
#sidebar:not(.expanded) { width: var(--sidebar-collapsed); }

/* ---------------------------------------------------------
   SIDEBAR HEADER
--------------------------------------------------------- */
.sidebar-header {
  display: flex;
  align-items: center;
  gap: 14px;
  height: 48px;
  padding: 8px 16px;
  transition: padding var(--transition), justify-content var(--transition), gap var(--transition);
}

#sidebar.expanded .sidebar-header {
  justify-content: flex-start;
}

#sidebar:not(.expanded) .sidebar-header {
  justify-content: center; /* true centering (after app-name collapses) */
  padding: 0;             /* remove side padding that can bias alignment */
  gap: 0;                 /* no invisible spacing */
}

/* APP NAME */
.app-name {
  font-size: 1.1rem;
  color: var(--c-text);
  opacity: 1;
  transition: opacity var(--transition);
}

/* COLLAPSED: app-name MUST NOT take layout space */
#sidebar:not(.expanded) .app-name {
  opacity: 0;
  pointer-events: none;

  width: 0;
  max-width: 0;
  margin: 0;
  padding: 0;
  overflow: hidden;
  white-space: nowrap;
}

/* HAMBURGER */
.toggle-btn {
  width: 38px;
  height: 38px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  background: none;
  border: none;
  cursor: pointer;
  transition: margin var(--transition), width var(--transition), height var(--transition);
}

/* COLLAPSED: make hamburger match icon buttons (48x48) and centered */
#sidebar:not(.expanded) .toggle-btn {
  width: var(--nav-item);
  height: var(--nav-item);
  margin: 0 auto;
  padding: 0;
}

.toggle-btn span {
  width: 24px;
  height: 3px;
  background: var(--c-text);
  border-radius: 2px;
  margin: 3px 0;
  transition: transform var(--transition), opacity var(--transition);
}

.toggle-btn.open span:nth-child(1) { transform: translateY(6px) rotate(45deg); }
.toggle-btn.open span:nth-child(2) { opacity: 0; }
.toggle-btn.open span:nth-child(3) { transform: translateY(-6px) rotate(-45deg); }

/* ---------------------------------------------------------
   SIDEBAR MENU
--------------------------------------------------------- */
.sidebar-menu {
  list-style: none;
  padding: 10px;
  margin: 20px 0;
  flex-grow: 1;
}

.sidebar-menu li { margin: 6px 0; }

.sidebar-menu a {
  width: 100%;
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 12px;
  border-radius: 10px;
  text-decoration: none;
  font-size: 0.95rem;
  color: #cfcfcf;
  text-align: left;
  transition: background var(--transition), color var(--transition),
              gap var(--transition), padding var(--transition),
              justify-content var(--transition);
}

.sidebar-menu a:hover {
  background: var(--c-accent-soft);
  color: white;
}

.sidebar-menu a.active {
  background: var(--c-accent);
  color: white;
}

/* FIXED ICON RULE (prevents large/logout scaling) */
.sidebar-menu img,
.sidebar-menu i {
  width: var(--icon-size);
  height: var(--icon-size);
  flex: 0 0 var(--icon-size);
}

/* TEXT */
.menu-text {
  opacity: 1;
  transition: opacity var(--transition);
}

#sidebar:not(.expanded) .menu-text {
  display: none;          /* hard-hide for perfect centering */
  opacity: 0;
  pointer-events: none;
}

/* EXPANDED ALIGNMENT */
#sidebar.expanded .sidebar-menu a {
  justify-content: flex-start;
  padding: 12px;
  gap: 14px;
}

/* COLLAPSED: fixed square buttons centered inside 80px */
#sidebar:not(.expanded) .sidebar-menu {
  padding-left: 0;
  padding-right: 0;
}

#sidebar:not(.expanded) .sidebar-menu a {
  width: var(--nav-item);
  height: var(--nav-item);
  padding: 0;
  margin: 0 auto;         /* centers the blue active indicator/background */
  justify-content: center;
  align-items: center;
  gap: 0;
  border-radius: 12px;
}

/* ---------------------------------------------------------
   SIDEBAR FOOTER (LOGOUT)
--------------------------------------------------------- */
.sidebar-footer {
  padding: 10px;
  border-top: 1px solid rgba(255,255,255,0.08);
  margin-top: auto; /* PIN TO BOTTOM */
}

.sidebar-footer a {
  width: 100%;
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px;
  border-radius: 10px;
  color: #cfcfcf;
  text-decoration: none;
  transition: background var(--transition), color var(--transition),
              gap var(--transition), padding var(--transition),
              justify-content var(--transition);
}

.sidebar-footer a:hover {
  background: rgba(255,255,255,0.07);
  color: white;
}

/* FIXED ICON RULE (logout included) */
.sidebar-footer a img,
.sidebar-footer a i {
  width: var(--icon-size);
  height: var(--icon-size);
  flex: 0 0 var(--icon-size);
}

/* EXPANDED LOGOUT */
#sidebar.expanded .sidebar-footer a {
  justify-content: flex-start;
  padding: 12px;
  gap: 14px; /* match menu */
}

/* COLLAPSED LOGOUT: fixed square centered */
#sidebar:not(.expanded) .sidebar-footer {
  padding-left: 0;
  padding-right: 0;
}

#sidebar:not(.expanded) .sidebar-footer a {
  width: var(--nav-item);
  height: var(--nav-item);
  padding: 0;
  margin: 0 auto;
  justify-content: center;
  align-items: center;
  gap: 0;
  border-radius: 12px;
}

/* ---------------------------------------------------------
   TOPBAR
--------------------------------------------------------- */
#topbar {
  position: fixed;
  top: 0;
  left: var(--sidebar-expanded);
  width: calc(100% - var(--sidebar-expanded));
  height: 64px;
  background: var(--c-card);
  color: var(--c-text-dark);
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 22px;
  box-shadow: var(--shadow);
  transition: left var(--transition), width var(--transition);
  z-index: 1200;
}

#sidebar:not(.expanded) ~ #topbar {
  left: var(--sidebar-collapsed);
  width: calc(100% - var(--sidebar-collapsed));
}

/* TOPBAR LEFT/RIGHT FIX */
.topbar-left,
.topbar-right {
  display: flex;
  align-items: center;
  gap: 18px;
  float: none !important;
}

/* TOPBAR ICON INTERACTION */
#themeToggle,
#notifBell {
  cursor: pointer;
  padding: 6px 10px;
  border-radius: 6px;
  transition: background var(--transition), color var(--transition);
}

#themeToggle:hover,
#notifBell:hover {
  background: var(--c-accent-soft);
  color: var(--c-accent);
}

/* PULSE360 FADE */
.topbar-title {
  font-size: 1.2rem;
  font-weight: 600;
  opacity: 1;
  transition: opacity var(--transition);
}

#sidebar.expanded ~ #topbar .topbar-title { opacity: 0; }
#sidebar:not(.expanded) ~ #topbar .topbar-title { opacity: 1; }

/* ---------------------------------------------------------
   PAGE CONTAINER
--------------------------------------------------------- */
#page-container {
  position: absolute;
  top: 64px;
  left: var(--sidebar-expanded);
  width: calc(100% - var(--sidebar-expanded));
  height: calc(100% - 64px);
  transition: left var(--transition), width var(--transition);
}

#sidebar:not(.expanded) ~ #page-container {
  left: var(--sidebar-collapsed);
  width: calc(100% - var(--sidebar-collapsed));
}

/* ---------------------------------------------------------
   USERNAME HOVER
--------------------------------------------------------- */
.user-display {
  cursor: pointer;
  padding: 6px 10px;
  border-radius: 6px;
  transition: background var(--transition), color var(--transition);
}

.user-display:hover {
  background: var(--c-accent-soft);
  color: var(--c-accent);
}

/* ---------------------------------------------------------
   NOTIFICATION DROPDOWN
--------------------------------------------------------- */
.notif-dropdown {
  position: absolute;
  top: 64px;
  right: 22px;
  width: 320px;
  background: var(--c-card);
  box-shadow: var(--shadow);
  border-radius: 10px;
  overflow: hidden;
  z-index: 1500;
  opacity: 0;
  transform: translateY(-10px);
  pointer-events: none;
  transition: opacity var(--transition), transform var(--transition);
}

.notif-dropdown.show {
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
}

.notif-header {
  padding: 12px 16px;
  font-weight: bold;
  background: var(--c-accent-soft);
  color: var(--c-text-dark);
}

.notif-list {
  max-height: 260px;
  overflow-y: auto;
}

.notif-item {
  padding: 12px 16px;
  border-bottom: 1px solid rgba(0,0,0,0.06);
  cursor: pointer;
  transition: background var(--transition);
}

.notif-item:hover { background: var(--c-accent-soft); }

.notif-item-title {
  font-weight: 600;
  color: var(--c-text-dark);
}

.notif-item-time {
  font-size: 0.85rem;
  color: #6b7280;
}

.notif-footer {
  padding: 10px;
  text-align: center;
  background: var(--c-card);
}

.notif-more {
  color: var(--c-accent);
  text-decoration: none;
  font-weight: 600;
}

/* DARK MODE SUPPORT */
:root.dark .notif-dropdown { background: var(--c-card); }
:root.dark .notif-item-title { color: var(--c-text); }
:root.dark .notif-item-time { color: #9ca3af; }

/* ---------------------------------------------------------
   MAP
--------------------------------------------------------- */
#map-container,
#dashmap {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

/* ---------------------------------------------------------
   PRELOADER
--------------------------------------------------------- */
.preloader-overlay {
  position: fixed;
  inset: 0;
  background: rgba(255,255,255,0.7);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 2000;
}

.loader {
  width: 50px;
  height: 50px;
  border: 5px solid rgba(0,0,0,0.2);
  border-top-color: var(--c-accent);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin { to { transform: rotate(360deg); } }
